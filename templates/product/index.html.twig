{% extends 'base.html.twig' %}

{% block title %}Produits - Backoffice
{% endblock %}

{% block body %}
	<div
		class="space-y-6">
		<!-- Header -->
		<div class="flex items-center justify-between">
			<div>
				<h1 class="text-3xl font-bold text-white">Produits</h1>
				<p class="text-gray-400 mt-1">Gérez le catalogue de produits</p>
			</div>
			<div class="flex items-center gap-4">
				{% if is_granted('PRODUCT_EXPORT') %}
					<a href="{{ path('app_product_export') }}" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gray-700 text-gray-300 font-medium rounded-lg hover:bg-gray-600 transition-all duration-200">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
						</svg>
						Export CSV
					</a>
				{% endif %}
				{% if is_granted('PRODUCT_CREATE') %}
					<a href="{{ path('app_product_create', {reset: 1}) }}" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-lg hover:from-indigo-500 hover:to-purple-500 transition-all duration-200 transform hover:scale-105">
						<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
						</svg>
						Nouveau produit
					</a>
				{% endif %}
			</div>
		</div>

		<!-- Sort Options -->
		<div class="flex items-center gap-4 bg-gray-800/30 rounded-lg p-4">
			<span class="text-gray-400 text-sm">Trier par :</span>
			<div class="flex gap-2">
				<a href="{{ path('app_product_index', {sort: 'name', direction: currentSort == 'name' and currentDirection == 'asc' ? 'desc' : 'asc'}) }}" class="px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 {{ currentSort == 'name' ? 'bg-indigo-600 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600' }}">
					Nom
					{% if currentSort == 'name' %}
						<svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="{{ currentDirection == 'asc' ? 'M5 15l7-7 7 7' : 'M19 9l-7 7-7-7' }}"/>
						</svg>
					{% endif %}
				</a>
				<a href="{{ path('app_product_index', {sort: 'price', direction: currentSort == 'price' and currentDirection == 'asc' ? 'desc' : 'asc'}) }}" class="px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 {{ currentSort == 'price' ? 'bg-indigo-600 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600' }}">
					Prix
					{% if currentSort == 'price' %}
						<svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="{{ currentDirection == 'asc' ? 'M5 15l7-7 7 7' : 'M19 9l-7 7-7-7' }}"/>
						</svg>
					{% endif %}
				</a>
				<a href="{{ path('app_product_index', {sort: 'type', direction: currentSort == 'type' and currentDirection == 'asc' ? 'desc' : 'asc'}) }}" class="px-3 py-1.5 rounded-lg text-sm font-medium transition-all duration-200 {{ currentSort == 'type' ? 'bg-indigo-600 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600' }}">
					Type
					{% if currentSort == 'type' %}
						<svg class="w-4 h-4 inline ml-1" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="{{ currentDirection == 'asc' ? 'M5 15l7-7 7 7' : 'M19 9l-7 7-7-7' }}"/>
						</svg>
					{% endif %}
				</a>
			</div>
		</div>

		<!-- Products Grid -->
		<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
			{% for product in products %}
				<div
					class="bg-gray-800/50 backdrop-blur-xl rounded-xl border border-gray-700/50 overflow-hidden hover:border-indigo-500/50 transition-all duration-300 group">
					<!-- Product Header -->
					<div class="p-6 border-b border-gray-700/50">
						<div class="flex items-start justify-between">
							<div class="flex-1">
								<h3 class="text-lg font-semibold text-white group-hover:text-indigo-400 transition-colors duration-200">
									{{ product.name }}
								</h3>
								<span class="inline-flex items-center mt-2 px-2.5 py-0.5 rounded-full text-xs font-medium
																				                            {% if product.type == 'digital' %}
																				                                bg-purple-500/20 text-purple-400 border border-purple-500/30
																				                            {% else %}
																				                                bg-emerald-500/20 text-emerald-400 border border-emerald-500/30
																				                            {% endif %}">
									{% if product.type == 'digital' %}
										<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"/>
										</svg>
										Numérique
									{% else %}
										<svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewbox="0 0 24 24">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
										</svg>
										Physique
									{% endif %}
								</span>
							</div>
							<div class="text-right">
								<p class="text-2xl font-bold bg-gradient-to-r from-indigo-400 to-purple-500 bg-clip-text text-transparent">
									{{ product.price|number_format(2, ',', ' ') }}
									€
								</p>
							</div>
						</div>
					</div>

					<!-- Product Description -->
					<div class="p-6 pt-4">
						<p class="text-gray-400 text-sm line-clamp-2">
							{{ product.description|default('Aucune description')|slice(0, 100) }}
							{% if product.description|length > 100 %}...
							{% endif %}
						</p>
					</div>

					<!-- Actions -->
					<div class="px-6 pb-6 flex items-center gap-2">
						<a href="{{ path('app_product_show', {id: product.id}) }}" class="flex-1 text-center px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700/50 rounded-lg hover:bg-gray-700 transition-all duration-200">
							Voir
						</a>
						{% if is_granted('PRODUCT_EDIT', product) %}
							<a href="{{ path('app_product_edit', {id: product.id, reset: 1}) }}" class="p-2 text-gray-400 hover:text-indigo-400 hover:bg-indigo-500/10 rounded-lg transition-all duration-200">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
								</svg>
							</a>
						{% endif %}
						{% if is_granted('PRODUCT_DELETE', product) %}
							<form action="{{ path('app_product_delete', {id: product.id}) }}" method="post" class="inline" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce produit ?');">
								<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ product.id) }}">
								<button type="submit" class="p-2 text-gray-400 hover:text-red-400 hover:bg-red-500/10 rounded-lg transition-all duration-200">
									<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
										<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
									</svg>
								</button>
							</form>
						{% endif %}
					</div>
				</div>
			{% else %}
				<div class="col-span-full">
					<div class="bg-gray-800/50 backdrop-blur-xl rounded-xl border border-gray-700/50 p-12 text-center">
						<svg class="w-16 h-16 mx-auto mb-4 text-gray-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
							<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
						</svg>
						<h3 class="text-xl font-semibold text-gray-400 mb-2">Aucun produit</h3>
						<p class="text-gray-500 mb-6">Commencez par créer votre premier produit</p>
						{% if is_granted('PRODUCT_CREATE') %}
							<a href="{{ path('app_product_create', {reset: 1}) }}" class="inline-flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-medium rounded-lg hover:from-indigo-500 hover:to-purple-500 transition-all duration-200">
								<svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
									<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
								</svg>
								Créer un produit
							</a>
						{% endif %}
					</div>
				</div>
			{% endfor %}
		</div>
	</div>
{% endblock %}
